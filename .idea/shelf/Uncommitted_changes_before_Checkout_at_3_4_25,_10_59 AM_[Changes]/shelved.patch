Index: app/src/main/java/com/woleapp/netpos/contactless/nibss/NetPosTerminalConfig.kt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@file:Suppress(\"ktlint:standard:no-wildcard-imports\")\n\npackage com.woleapp.netpos.contactless.nibss\n\nimport android.content.Context\nimport android.content.Intent\nimport android.os.Build\nimport android.text.format.DateUtils\nimport androidx.lifecycle.LiveData\nimport androidx.lifecycle.MutableLiveData\nimport androidx.localbroadcastmanager.content.LocalBroadcastManager\nimport com.danbamitale.epmslib.entities.*\nimport com.danbamitale.epmslib.processors.TerminalConfigurator\nimport com.pixplicity.easyprefs.library.Prefs\nimport com.woleapp.netpos.contactless.model.ConfigurationData\nimport com.woleapp.netpos.contactless.util.*\nimport com.woleapp.netpos.contactless.util.Singletons.getSavedConfigurationData\nimport com.woleapp.netpos.contactless.util.Singletons.gson\nimport io.reactivex.Single\nimport io.reactivex.android.schedulers.AndroidSchedulers\nimport io.reactivex.disposables.CompositeDisposable\nimport io.reactivex.schedulers.Schedulers\nimport timber.log.Timber\n\nconst val CONFIGURATION_STATUS = \"terminal_configuration_status\"\nconst val CONFIGURATION_ACTION = \"com.woleapp.netpos.TERMINAL_CONFIGURATION\"\n\nclass NetPosTerminalConfig {\n    companion object {\n        private var configurationData: ConfigurationData = getSavedConfigurationData()\n        private val disposables = CompositeDisposable()\n\n        //        var connectionData: ConnectionData = ConnectionData(\n//            ipAddress = \"196.6.103.10\",\n//            ipPort = 55533,\n//            isSSL = true\n//        )\n        var connectionData: ConnectionData =\n            ConnectionData(\n                ipAddress = configurationData.ip,\n                ipPort = configurationData.port.toInt(),\n                isSSL = false,\n            )\n        private var terminalId: String? = null\n        var isConfigurationInProcess = false\n        var configurationStatus = -1\n        private val mutableLiveData = MutableLiveData(Event(-99))\n        val liveData: LiveData<Event<Int>>\n            get() = mutableLiveData\n        private val sendIntent = Intent(CONFIGURATION_ACTION)\n        private var terminalConfigurator: TerminalConfigurator =\n            TerminalConfigurator(connectionData)\n\n        fun getTerminalId() = terminalId ?: \"\"\n\n        private fun setTerminalId() {\n            terminalId = Singletons.getCurrentlyLoggedInUser()?.terminal_id\n//            terminalId = \"20398A4C\"\n            // Log.d(\"CHECKTT\", terminalId.toString())\n        }\n\n        private var keyHolder: KeyHolder? = null\n\n        private var configData: ConfigData? = null\n\n        fun getConfigData(): ConfigData? = configData\n\n        fun getKeyHolder(): KeyHolder? = keyHolder\n\n        fun init(\n            context: Context,\n            configureSilently: Boolean = false,\n        ) {\n            KeyHolder.setHostKeyComponents(\n                configurationData.key1,\n                configurationData.key2,\n            ) // default to test  //Set your base keys here\n\n            setTerminalId()\n            Timber.e(\"Terminal ID: $terminalId\")\n            keyHolder = Singletons.getKeyHolder()\n            configData = Singletons.getConfigData()\n            val localBroadcastManager = LocalBroadcastManager.getInstance(context)\n            if (isConfigurationInProcess) {\n                return\n            }\n            configurationStatus = 0\n            sendIntent.putExtra(CONFIGURATION_STATUS, configurationStatus)\n            localBroadcastManager.sendBroadcast(sendIntent)\n            if (configureSilently.not()) {\n                mutableLiveData.value = Event(configurationStatus)\n                mutableLiveData.value = Event(-99)\n            }\n            val req =\n                when {\n                    DateUtils.isToday(Prefs.getLong(LAST_POS_CONFIGURATION_TIME, 0)).not() -> {\n                        Timber.e(\"last configuration time was not today, configure terminal now\")\n                        configureTerminal(context)\n                    }\n                    keyHolder != null && configData != null -> {\n                        Timber.e(\"calling home\")\n                        configurationStatus = 1\n                        callHome(context).onErrorResumeNext {\n                            Timber.e(it)\n                            Timber.e(\"call home failed, configure terminal\")\n                            configureTerminal(context)\n                        }\n                    }\n                    else -> configureTerminal(context)\n                }\n            val disposable =\n                req.subscribeOn(Schedulers.io())\n                    .observeOn(AndroidSchedulers.mainThread())\n                    .doOnSubscribe {\n                        isConfigurationInProcess = true\n                    }\n                    .doFinally { isConfigurationInProcess = false }\n                    .subscribe { pair, error ->\n                        error?.let {\n                            // TerminalManager.getInstance().beep(context, TerminalManager.BEEP_MODE_FAILURE)\n                            configurationStatus = -1\n                            if (configureSilently.not()) {\n                                mutableLiveData.value = Event(configurationStatus)\n                                mutableLiveData.value = Event(-99)\n                            }\n                            sendIntent.putExtra(CONFIGURATION_STATUS, configurationStatus)\n                            localBroadcastManager.sendBroadcast(sendIntent)\n                            Timber.e(it)\n                        }\n                        pair?.let {\n                            pair.first?.let {\n                                Prefs.putLong(LAST_POS_CONFIGURATION_TIME, System.currentTimeMillis())\n                                Prefs.putString(PREF_CONFIG_DATA, gson.toJson(pair.second))\n                                Prefs.putString(PREF_KEYHOLDER, gson.toJson(pair.first))\n                                // Log.d(\"PINKEY\", pair.first!!.clearPinKey)\n                                this.configData = pair.second\n                            }\n                            configurationStatus = 1\n                            sendIntent.putExtra(CONFIGURATION_STATUS, configurationStatus)\n                            localBroadcastManager.sendBroadcast(sendIntent)\n                            if (configureSilently.not()) {\n                                mutableLiveData.value = Event(configurationStatus)\n                                mutableLiveData.value = Event(-99)\n                            }\n                            Timber.e(\"Config data set\")\n                            disposeDisposables()\n                        }\n                    }\n            disposables.add(disposable)\n        }\n\n        private fun callHome(context: Context): Single<Pair<KeyHolder?, ConfigData?>> {\n            Timber.e(keyHolder.toString())\n            return terminalConfigurator.nibssCallHome(\n                context,\n                getTerminalId(),\n                keyHolder?.clearSessionKey ?: \"\",\n                Build.ID,\n            ).flatMap {\n                // Timber.e(\"call home result $it\")\n                if (it == \"00\") {\n                    return@flatMap Single.just(Pair(null, null))\n                } else {\n                    Single.error(Exception(\"call home failed\"))\n                }\n            }\n        }\n\n        private fun configureTerminal(context: Context): Single<Pair<KeyHolder?, ConfigData?>> =\n            terminalConfigurator.downloadNibssKeys(context, getTerminalId())\n                .flatMap { nibssKeyHolder ->\n                    keyHolder = nibssKeyHolder\n                    terminalConfigurator.downloadTerminalParameters(\n                        context,\n                        getTerminalId(),\n                        nibssKeyHolder.clearSessionKey,\n                        Build.ID,\n                    ).map { nibssConfigData ->\n                        configData = nibssConfigData\n                        return@map Pair(nibssKeyHolder, nibssConfigData)\n                    }\n                }\n\n        private fun disposeDisposables() {\n            disposables.clear()\n        }\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/woleapp/netpos/contactless/nibss/NetPosTerminalConfig.kt b/app/src/main/java/com/woleapp/netpos/contactless/nibss/NetPosTerminalConfig.kt
--- a/app/src/main/java/com/woleapp/netpos/contactless/nibss/NetPosTerminalConfig.kt	(revision 691b56f5913a58ec8eee0a39431f90ea8fe072c6)
+++ b/app/src/main/java/com/woleapp/netpos/contactless/nibss/NetPosTerminalConfig.kt	(date 1741081833413)
@@ -39,7 +39,7 @@
             ConnectionData(
                 ipAddress = configurationData.ip,
                 ipPort = configurationData.port.toInt(),
-                isSSL = false,
+                isSSL = true,
             )
         private var terminalId: String? = null
         var isConfigurationInProcess = false
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"DesignSurface\">\n    <option name=\"filePathToZoomLevelMap\">\n      <map>\n        <entry key=\"app/src/fcmb/res/layout/activity_main.xml\" value=\"0.19081272084805653\" />\n        <entry key=\"app/src/fcmb/res/layout/dashboard_header.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/fcmb/res/mipmap-anydpi-v26/ic_launcher.xml\" value=\"0.1045\" />\n        <entry key=\"app/src/firstbank/res/layout/dialog_select_account_type.xml\" value=\"0.1175925925925926\" />\n        <entry key=\"app/src/firstbank/res/layout/fragment_login.xml\" value=\"0.1175925925925926\" />\n        <entry key=\"app/src/main/res/drawable/action_button_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/animated_check.xml\" value=\"0.161\" />\n        <entry key=\"app/src/main/res/drawable/bg_gradient.xml\" value=\"0.1075\" />\n        <entry key=\"app/src/main/res/drawable/bg_white_background_rounded.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/bottom_sheet_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/check_mark.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/curve_bg.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/edittext_bg.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_add.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_airtime_data.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_arrow_drop_down.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_baseline_print_24.xml\" value=\"0.202\" />\n        <entry key=\"app/src/main/res/drawable/ic_baseline_settings.xml\" value=\"0.202\" />\n        <entry key=\"app/src/main/res/drawable/ic_bill.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_btn_cancel.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_card_approved.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_card_declined.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_close.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_content_copy.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_download.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_end_of_day.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_error.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_globe.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_home_icon.xml\" value=\"0.2425\" />\n        <entry key=\"app/src/main/res/drawable/ic_launcher_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_lending.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_logout.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_message.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_notifications_none.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_pay_cash_icon.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_power.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_pre_auth.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_pre_auth_completion.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_pre_auth_new.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_print.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_print_all.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_print_one.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_purchase.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_qr_code.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_search.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_share.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_television.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_trans.xml\" value=\"0.202\" />\n        <entry key=\"app/src/main/res/drawable/ic_warning.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/ic_write.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/login_button_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/services_edittext_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/services_edittext_background_disabled.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/sheet_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/drawable/splash_background.xml\" value=\"0.125\" />\n        <entry key=\"app/src/main/res/drawable/white_custom_progress_bar.xml\" value=\"0.183\" />\n        <entry key=\"app/src/main/res/layout/activity_main.xml\" value=\"0.25\" />\n        <entry key=\"app/src/main/res/layout/dashboard_header.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/main/res/layout/dialog_account_number_layout.xml\" value=\"0.1796875\" />\n        <entry key=\"app/src/main/res/layout/dialog_print_type.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/dialog_terms_and_conditions.xml\" value=\"0.165\" />\n        <entry key=\"app/src/main/res/layout/fragment_complete_qr_payment_web_view.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/fragment_dashboard.xml\" value=\"0.25\" />\n        <entry key=\"app/src/main/res/layout/fragment_exisiting_customers_registration.xml\" value=\"0.25\" />\n        <entry key=\"app/src/main/res/layout/fragment_login.xml\" value=\"0.375\" />\n        <entry key=\"app/src/main/res/layout/fragment_new_or_existing.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/fragment_pdf_viewer.xml\" value=\"0.1921875\" />\n        <entry key=\"app/src/main/res/layout/fragment_register.xml\" value=\"0.25\" />\n        <entry key=\"app/src/main/res/layout/fragment_registration_o_t_p.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/fragment_reprint.xml\" value=\"0.17447916666666666\" />\n        <entry key=\"app/src/main/res/layout/fragment_reprint_transactions.xml\" value=\"0.25\" />\n        <entry key=\"app/src/main/res/layout/fragment_sales.xml\" value=\"0.375\" />\n        <entry key=\"app/src/main/res/layout/fragment_terms_and_conditions.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/main/res/layout/fragment_transaction_details.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/fragment_transaction_history.xml\" value=\"0.17447916666666666\" />\n        <entry key=\"app/src/main/res/layout/fragment_transactions.xml\" value=\"0.19427083333333334\" />\n        <entry key=\"app/src/main/res/layout/layout_enter_otp_fragment.xml\" value=\"0.159375\" />\n        <entry key=\"app/src/main/res/layout/layout_fragment_barcode.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/main/res/layout/layout_loading_dialog.xml\" value=\"0.335\" />\n        <entry key=\"app/src/main/res/layout/layout_pos_receipt_pdf.xml\" value=\"0.335\" />\n        <entry key=\"app/src/main/res/layout/layout_randomized_pin_block.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/main/res/layout/layout_service_item.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/main/res/layout/layout_verve_card_qr_amount_dialog.xml\" value=\"0.2947916666666667\" />\n        <entry key=\"app/src/main/res/layout/qr_amout_dialog.xml\" value=\"0.15833333333333333\" />\n        <entry key=\"app/src/main/res/menu/bottom_nav.xml\" value=\"0.30885416666666665\" />\n        <entry key=\"app/src/providus/res/drawable/dashboard_background.xml\" value=\"0.202\" />\n        <entry key=\"app/src/providus/res/drawable/fragment_header_background.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_baseline_print_24.xml\" value=\"0.202\" />\n        <entry key=\"app/src/providus/res/drawable/ic_baseline_settings.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_pay_cash_icon.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_print.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_print_all.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_print_one.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_purchase.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_qr_code.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/drawable/ic_trans.xml\" value=\"0.202\" />\n        <entry key=\"app/src/providus/res/drawable/ic_write.xml\" value=\"0.183\" />\n        <entry key=\"app/src/providus/res/layout/dashboard_header.xml\" value=\"0.3239995320638021\" />\n        <entry key=\"app/src/providus/res/layout/dialog_terms_and_conditions.xml\" value=\"0.13177083333333334\" />\n        <entry key=\"app/src/providus/res/layout/fragment_login.xml\" value=\"0.18020833333333333\" />\n        <entry key=\"app/src/providus/res/layout/fragment_reprint.xml\" value=\"0.17447916666666666\" />\n        <entry key=\"app/src/providus/res/layout/fragment_sales.xml\" value=\"0.17447916666666666\" />\n        <entry key=\"app/src/providus/res/layout/fragment_transaction_history.xml\" value=\"0.17447916666666666\" />\n        <entry key=\"app/src/providus/res/layout/fragment_transactions.xml\" value=\"0.34688995215311\" />\n        <entry key=\"app/src/providus/res/layout/layout_service_item.xml\" value=\"0.3098958333333333\" />\n        <entry key=\"app/src/wemabank/res/drawable/ic_logout.xml\" value=\"0.192\" />\n        <entry key=\"app/src/wemabank/res/layout/dashboard_header.xml\" value=\"0.18020833333333333\" />\n        <entry key=\"app/src/wemabank/res/layout/dialog_select_account_type.xml\" value=\"0.25\" />\n        <entry key=\"app/src/zenith/res/drawable/ic_logout.xml\" value=\"0.192\" />\n        <entry key=\"app/src/zenith/res/layout/dashboard_header.xml\" value=\"0.335\" />\n        <entry key=\"app/src/zenith/res/layout/fragment_dashboard.xml\" value=\"0.18385416666666668\" />\n      </map>\n    </option>\n  </component>\n  <component name=\"ProjectRootManager\" version=\"2\" languageLevel=\"JDK_11\" default=\"true\" project-jdk-name=\"Embedded JDK\" project-jdk-type=\"JavaSDK\" />\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/misc.xml b/.idea/misc.xml
--- a/.idea/misc.xml	(revision 691b56f5913a58ec8eee0a39431f90ea8fe072c6)
+++ b/.idea/misc.xml	(date 1741081778853)
@@ -117,5 +117,6 @@
       </map>
     </option>
   </component>
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_11" default="true" project-jdk-name="Embedded JDK" project-jdk-type="JavaSDK" />
+  <component name="ExternalStorageConfigurationManager" enabled="true" />
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_17" default="true" project-jdk-name="17" project-jdk-type="JavaSDK" />
 </project>
\ No newline at end of file
